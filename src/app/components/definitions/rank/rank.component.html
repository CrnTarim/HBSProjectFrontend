<div class="p-3">
  <h4>Rütbe Tanımları</h4>

  <!-- Grid -->
  <dx-data-grid
    [dataSource]="ranks"
    [showBorders]="true"
    [columnAutoWidth]="true"
    [allowColumnResizing]="true"
    [rowAlternationEnabled]="true"
    [hoverStateEnabled]="true"
    keyExpr="id"
    (onRowClick)="onRowSelect($event.data)"
  >
    <dxo-paging [pageSize]="10"></dxo-paging>
    <dxo-pager
      [showPageSizeSelector]="true"
      [allowedPageSizes]="[5, 10, 20]"
      showInfo="true"
    ></dxo-pager>

    <dxi-column dataField="code" caption="Kod"></dxi-column>
    <dxi-column dataField="name" caption="Rütbe"></dxi-column>
    <dxi-column
      dataField="createdDate"
      caption="Oluşturulma Tarihi"
      dataType="date"
      format="dd.MM.yyyy"
    ></dxi-column>
  </dx-data-grid>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="text-center mt-3">
    <span class="spinner-border text-info" role="status"></span>
  </div>

  <!-- Form -->
  <div class="card mt-4 p-3 shadow-sm">
    <h5>{{ selectedRank ? 'Rütbe Güncelle' : 'Yeni Rütbe Ekle' }}</h5>

    <form [formGroup]="rankForm">
      <div class="form-group mt-2">
        <label for="code">Kod</label>
        <input
          id="code"
          type="number"
          formControlName="code"
          class="form-control"
          placeholder="Kod giriniz"
        />
      </div>

      <div class="form-group mt-3">
        <label for="name">Rütbe Adı</label>
        <input
          id="name"
          type="text"
          formControlName="name"
          class="form-control"
          placeholder="Rütbe adını giriniz"
        />
      </div>

      <div class="d-flex justify-content-between mt-4">
        <button
          type="button"
          class="btn btn-primary"
          (click)="openConfirm()"
          [disabled]="rankForm.invalid"
        >
          Kaydet
        </button>

        <button
          type="button"
          class="btn btn-secondary"
          (click)="newRank()"
        >
          Yeni Kayıt
        </button>
      </div>
    </form>
  </div>

  <!-- Popup -->
  <dx-popup
    [(visible)]="popupVisible"
    [width]="400"
    [height]="200"
    [showTitle]="true"
    title="Emin misiniz?"
  >
    <div class="p-3">
      <p>Değişiklikleri kaydetmek istediğinize emin misiniz?</p>

      <div class="text-end mt-3">
        <button class="btn btn-success me-2" (click)="saveRank()">Kaydet</button>
        <button class="btn btn-danger" (click)="popupVisible = false">Vazgeç</button>
      </div>
    </div>
  </dx-popup>
</div>
