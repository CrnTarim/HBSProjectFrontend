<div class="p-3">
  <h4>Rütbe Tanımları</h4>

  <!-- 1) Üstte: Arama + Temizle butonu aynı satır -->
  <div class="d-flex mb-2">
    <input
      type="text"
      class="form-control mr-2"
      placeholder="Kod / Rütbe ara..."
      [(ngModel)]="searchText"
      (input)="onSearchChange()"
    />

    <button
      type="button"
      class="btn btn-outline-secondary"
      (click)="clearGridSearch()"
    >
      Temizle
    </button>
  </div>

  <!-- 2) Yükleniyor göstergesi (istersen formun üstünde dursun) -->
  <div *ngIf="isLoading" class="text-center my-3">
    <span class="spinner-border text-info" role="status"></span>
  </div>

  <!-- 3) Form KARTI (artık full width, flex içinde değil) -->
  <div class="card mt-4 p-3 shadow-sm">
    <h5>{{ selectedHospital ? 'Rütbe Güncelle' : 'Yeni Rütbe Ekle' }}</h5>

    <form [formGroup]="hospitalForm">
      <div class="form-group mt-2">
        <label for="code">Kod</label>
        <input
          id="code"
          type="number"
          formControlName="code"
          class="form-control"
          placeholder="Hastane Kodunu giriniz"
        />
      </div>

      <div class="form-group mt-3">
        <label for="name">Hastane Adı</label>
        <input
          id="name"
          type="text"
          formControlName="name"
          class="form-control"
          placeholder="Hastane adını giriniz"
        />
      </div>

      <div class="form-group mt-3">
        <label for="name">Şehir Kodu</label>
        <input
          id="codecity"
          type="number"
          formControlName="codecity"
          class="form-control"
          placeholder="Şehir Kodu Giriniz"
        />
      </div>

      <div class="d-flex mt-4">
      
        <button
          *ngIf="!selectedHospital"
          type="button"
          class="btn btn-primary mr-2"
          (click)="openConfirm()"
          [disabled]="hospitalForm.invalid"
        >
          Kaydet
        </button>

        <button
          *ngIf="selectedHospital"
          type="button"
          class="btn btn-danger mr-2"
          (click)="deleteRank()"
        >
          Sil
        </button>

        <button
          *ngIf="!selectedHospital"
          type="button"
          class="btn btn-secondary"
          (click)="newHospital()"
        >
          Yeni Kayıt
        </button>
      </div>
    </form>
  </div>

  <!-- 4) En altta GRID -->
  <div class="mt-4">
    <dx-data-grid
      #rankGrid
      [dataSource]="hospitals"
      [showBorders]="true"
      [columnAutoWidth]="true"
      [allowColumnResizing]="true"
      [rowAlternationEnabled]="true"
      [hoverStateEnabled]="true"
      keyExpr="id"
      (onRowClick)="onRowSelect($event.data)"
    >
      <dxo-paging [pageSize]="10"></dxo-paging>
      <dxo-pager
        [showPageSizeSelector]="true"
        [allowedPageSizes]="[5, 10, 20]"
        [showInfo]="true"
      ></dxo-pager>

      <dxi-column dataField="code" caption="Kod"></dxi-column>
      <dxi-column dataField="name" caption="Rütbe"></dxi-column>
      <dxi-column
        dataField="createdDate"
        caption="Oluşturulma Tarihi"
        dataType="date"
        format="dd.MM.yyyy"
      ></dxi-column>
    </dx-data-grid>
  </div>

  <!-- Popup -->
  <dx-popup
    [(visible)]="popupVisible"
    [width]="400"
    [height]="200"
    [showTitle]="true"
    title="Emin misiniz?"
  >
    <div class="p-3">
      <p>Değişiklikleri kaydetmek istediğinize emin misiniz?</p>

      <div class="text-end mt-3">
        <button class="btn btn-success me-2" (click)="saveHospital()">Kaydet</button>
        <button class="btn btn-danger" (click)="popupVisible = false">Vazgeç</button>
      </div>
    </div>
  </dx-popup>
</div>
